# Loan with collateral
# (https://github.com/chain-engineering/chainos/blob/master/docs/spec/p2c.md#loan-with-a-collateral)

contract loan(price, currency, deadline, creditorScript, debtorScript) {
  clause keep() {
    time() >= deadline && checkpredicate(creditorScript)
  }
  clause repurchase() {
    reserveoutput(price, currency, creditorScript) && checkpredicate(debtorScript)
  }
  clause mutual() {
    checkpredicate(debtorScript) && checkpredicate(creditorScript)
  }
  clause sell(newCreditorScript) {
    reserveoutput(amount(), asset(), loan(price, currency, deadline, newCreditorScript, debtorScript)) && checkpredicate(creditorScript)
  }
}
