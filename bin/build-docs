#!/usr/bin/env bash
set -e

echo "Compiling source documentation..."

COMPILE_DEST_PATH=`mktemp -d`
trap "rm -rf $COMPILE_DEST_PATH" EXIT

go install chain/cmd/md2html
cd $CHAIN/docs
md2html $COMPILE_DEST_PATH

echo "Building Java SDK..."

JAVA_DEST_PATH=$COMPILE_DEST_PATH/java
JAVADOC_DEST_PATH=$JAVA_DEST_PATH/javadoc

cd $CHAIN/sdk/java
mvn package > /dev/null
mkdir -p $JAVA_DEST_PATH
cp  target/chain-sdk-java*[[:digit:]].jar $JAVA_DEST_PATH/chain-sdk-latest.jar
mkdir -p $JAVADOC_DEST_PATH
cp -R target/apidocs/* $JAVADOC_DEST_PATH

echo "Bundling into cored..."

BUNDLE_PATH=$CHAIN/generated/docs
BUNDLE_FILE=$BUNDLE_PATH/docs.go

go install chain/cmd/gobundle
mkdir -p $BUNDLE_PATH
gobundle -package docs $COMPILE_DEST_PATH > $BUNDLE_FILE
gofmt -w $BUNDLE_FILE
